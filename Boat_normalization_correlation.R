
######DATA NORMALIZATION#################################

normalize_positive <-function(x) {
  (x - min(x,na.rm = TRUE))/(max(x,na.rm = TRUE)-min(x,na.rm = TRUE))
}

normalize_negative <-function(x) {
  (max(x,na.rm = TRUE)-x)/(max(x,na.rm = TRUE)-min(x,na.rm = TRUE))
}

#1.######################ECOLOGICAL##########
#A. ###########EXPOSURE
##1. read cvs indicators (import database)
##cambiar nombres
Boat_ecological.exposure.INDICATORS <- read.csv("data/CSV_ecological_boat/Boat_ecological_exposure.INDICATORS.csv", sep = ";" )

##2. use functions to normalize:
##a) Normalization positive
exposure<- Boat_ecological.exposure.INDICATORS %>% 
  select(fishing.guild, Temp, PP)%>% 
  distinct%>%
  mutate (TempN=normalize_positive(Temp),
          PPN=normalize_positive(PP))

exposure.N<- exposure [, c(1, 4, 5)]

eco.exposure <- exposure.N [, c(2:3)]
eco.exporuse.cor <- cor(eco.exposure, use = "pairwise.complete.obs")
p1 <- corrplot(eco.exporuse.cor, order ="AOE")


#B. ###########SENSITIVITY
##1. read cvs indicators (import database)

Boat_ecological.sensitivity.INDICATORS <- read.csv("data/CSV_ecological_boat/Boat_ecological.sensitivity.INDICATORS.csv", sep = ";" )

##2. use functions to normalize:
##a) Normalization positive

sensitivity<- Boat_ecological.sensitivity.INDICATORS %>% 
  select(fishing.guild, Q, ABUND, HARV, EXPLOT)%>% 
  distinct%>%
  mutate (QN=normalize_positive(Q),
          ABUNDN=normalize_positive(ABUND),
          HARVN=normalize_positive(HARV),
          EXPLOTN=normalize_positive(EXPLOT))

sensitivity.N<- sensitivity [, c(1, 6, 7, 8, 9)]

eco.sensitivity <- sensitivity.N [, c(2:5)]
eco.sensitivity.cor <- cor(eco.sensitivity, use = "pairwise.complete.obs")
p2 <- corrplot(eco.sensitivity.cor, order ="AOE")

#C. ############RECOVERY POTENTIAL
##1. read cvs indicators (import database)

Boat_ecological.recoverypot.INDICATORS <- read.csv("data/CSV_ecological_boat/Boat_ecological.recoverypot.INDICATORS.csv", sep = ";" )

##2. use functions to normalize:
##a) Normalization positive

recovery.pot<- Boat_ecological.recoverypot.INDICATORS %>% 
  select(fishing.guild, bank.length, bank.area)%>% 
  distinct%>%
  mutate (bank.lengthN=normalize_positive(bank.length),
          bank.areaN=normalize_positive(bank.area))
        
recovery.potN<- recovery.pot [, c(1, 4, 5)]

eco.recoverypot <- recovery.potN [, c(2:3)]
eco.recoverypot.cor <- cor(eco.recoverypot, use = "pairwise.complete.obs")
p3 <- corrplot(eco.recoverypot.cor, order ="AOE")

##########MATRIX DE CORRELACIONES#############
# READ DE DATA (si queremos analizar los datos de manera conjunta)
#corr.matrix<- merge(exposure.N, sensitivity.N)
#corr.matrix2<- merge(corr.matrix, recovery.potN)
#cor.eco_indicators.matrix <- (corr.matrix2 [ ,2:10])
#ecological_correlation <- cor(cor.eco_indicators.matrix, use="pairwise.complete.obs")
#p4 <- corrplot(ecological_correlation, order ="AOE")


#2. ######################SOCIOECONOMIC##########
##1. read cvs indicators (import database)
#A. SENSITIVITY

Boat_socioeco.sensitivity <- read.csv("Data/CSV_socio.eco_boat/Boat_socioeco.sensitivity.csv", sep = ";" )

##2. use functions to normalize:
##a) Normalization positive
sensitivity.SE<- Boat_socioeco.sensitivity %>% 
  select(fishing.guild, NFISHERS, FDAYS, CATCH.V, KG.SOLD, DAYS.SOLD, POUCH, ISO, UNEMP)%>% 
  distinct%>%
  mutate (NFISHERSN=normalize_positive(NFISHERS),
          FDAYSN=normalize_positive(FDAYS),
          CATCH.VN=normalize_positive(CATCH.V),
          KG.SOLDN=normalize_positive(KG.SOLD),
          DAYS.SOLDN=normalize_positive(DAYS.SOLD),
          POUCHN=normalize_positive(POUCH),
          ISON=normalize_positive(ISO),
          UNEMPN=normalize_positive(UNEMP))

sensitivity.SE.N<- sensitivity.SE [, c(1, 10:17)]

socioeco.sensitivity <- sensitivity.SE.N [, c(2:9)]
socioeco.sensitivity.cor <- cor(socioeco.sensitivity, use = "pairwise.complete.obs")
p5 <- corrplot(socioeco.sensitivity.cor, order ="AOE")

#B. ADAPTIVE CAPACITY
##1. read cvs indicators (import database)

Boat.socioeco.adaptcap <- read.csv("Data/CSV_socio.eco_boat/Boat.socioeco.adaptcap.csv", sep = ";" )

##2. use functions to normalize:
##a) Normalization positive
adapt.cap<- Boat.socioeco.adaptcap %>% 
  select(fishing.guild, CPI, GROSS.SALARY, POB.RISK, TOURIST, MARKET, ROTATION, CLOUSURE)%>% 
  distinct%>%
  mutate (CPIN=normalize_positive(CPI),
          GROSS.SALARYN=normalize_positive(GROSS.SALARY),
          POB.RISKN=normalize_positive(POB.RISK),
          TOURISTN=normalize_positive(TOURIST),
          MARKETN=normalize_positive(MARKET),
          ROTATION.N=normalize_positive(ROTATION),
          CLOUSURE.N=normalize_positive(CLOUSURE))

adapt.cap.N<- adapt.cap [, c(1, 9:15)]

socioeco.adaptcap <- adapt.cap.N [, c(2:8)]
socioeco.adaptcap.cor <- cor(socioeco.adaptcap, use = "pairwise.complete.obs")
p6 <- corrplot(socioeco.adaptcap.cor, order ="AOE")

##########MATRIX DE CORRELACIONES#############
# READ DE DATA (en caso de querer analizar los indicadores conjuntamente)
#SE.corr.matrix<- merge(sensitivity.SE.N, adapt.cap.N)

####FACTORS_ECOLOGICAL#####       
#a. ecological exposure
exposure.N
factor1=transform(exposure.N,EXPOSURE= TempN+PPN) 
CLIME= factor1 [, c(1, 4)]
EXPOSURE= CLIME

#b. ecological sensitivity
sensitivity.N
factor2= sensitivity.N [, c(1, 2)]
factor2 

Quantity_change= sensitivity.N$ABUNDN+sensitivity.N$HARVN+sensitivity.N$EXPLOTN
factor3=transform(sensitivity.N,Quantity_change= ABUNDN+HARVN+EXPLOTN)
factor3

Sensitiv.factor=transform(factor3,SENSITIVITY=QN+ Quantity_change)
SENSITIVITY= Sensitiv.factor [, c(1, 7)]
SENSITIVITY

#c. ecological recovery potencial
recovery.potN
factor4= transform(recovery.potN, RECOVERY.POT=bank.lengthN+bank.areaN)
RECOVERY.POT=factor4 [, c(1, 4)]

#FACTORS MATRIX
Factors.matrix1<- merge(EXPOSURE, SENSITIVITY)
Factors.matrix2<- merge(Factors.matrix1, RECOVERY.POT)
write.table(Factors.matrix2, file="Boat_Factors_ecological.matrix.csv", sep = ";" )
Boat_Factors_ecological.matrix <- read.csv("Boat_Factors_ecological.matrix.csv", sep = ";" )

#ECOLOGICAL VULNERABILITY INDEX
ECOLOGICAL_VUL= transform (Factors.matrix2, ECOLOGICAL.VUL=EXPOSURE+SENSITIVITY-RECOVERY.POT)
ECOLOGICAL_VULNERABILITY= ECOLOGICAL_VUL [, c(1, 5)]
write.table(ECOLOGICAL_VULNERABILITY, file="Boat_ecological_vulnerability.csv", sep = ";" )
Boat_ecological_vulnerability <- read.csv("Boat_ecological_vulnerability.csv", sep = ";" )

####FACTORS_SOCIOECONOMIC####
#a.socioeco_sensitivity
WORK.OPERATION=NFishersN+FdaysN
WORK.OPERATION

PROFIT= BenefitN+Catch.VN+Kg.soldN+Days.soldN
PROFIT

POUCH=PouchN
POUCH

EMPLOY= IsoN+UnempN
EMPLOY

SENSITIVITY.SE= WORK.OPERATION+PROFIT+EMPLOY+POUCH
SENSITIVITY.SE

#b. socio_eco adaptive capacity
ECONOMIC.STRENGTH= Gross.salaryN-CPIN #Revisar si es + o -
ECONOMIC.STRENGTH

DEPENDENCY=Pob.riskN+Resour.depN+MarketN
DEPENDENCY

MANGMT.STRATEGIES= RotationN+ClousureN

LIVELIHOOD.DIV=TourismN+Income.depN
LIVELIHOOD.DIV

ADAPTIVE.CAPACITY= ECONOMIC.STRENGTH + MANGMT.STRATEGIES+ LIVELIHOOD.DIV- DEPENDENCY
ADAPTIVE.CAPACITY

######Socio-ecological vulnerabiliy######
SOCIO_ECOLOGICAL.VULNERABILITY= ECOLOGICAL_VULNERABILITY+SENSITIVITY.SE-ADAPTIVE.CAPACITY