
######DATA NORMALIZATION#################################

normalize_positive <-function(x) {
  (x - min(x,na.rm = TRUE))/(max(x,na.rm = TRUE)-min(x,na.rm = TRUE))
}

normalize_negative <-function(x) {
  (max(x,na.rm = TRUE)-x)/(max(x,na.rm = TRUE)-min(x,na.rm = TRUE))
}

#1.######################ECOLOGICAL##########
#A. ###########EXPOSURE
##1. read cvs indicators (import database)
##cambiar nombres
Boat_ecological.exposure.INDICATORS <- read.csv("data/CSV_ecological_boat/Boat_ecological_exposure.INDICATORS.csv", sep = ";" )

##2. use functions to normalize:
##a) Normalization positive
exposure<- Boat_ecological.exposure.INDICATORS %>% 
  select(fishing.guild, Temp, PP, IR)%>% 
  distinct%>%
  mutate (TempN=normalize_positive(Temp),
          PPN=normalize_positive(PP),
          IRN=normalize_positive(IR))

exposure.N<- exposure [, c(1, 5, 6, 7)]

eco.exposure <- exposure.N [, c(2:4)]
eco.exporuse.cor <- cor(eco.exposure, use = "pairwise.complete.obs")
p1 <- corrplot(eco.exporuse.cor, order ="AOE")


#B. ###########SENSITIVITY
##1. read cvs indicators (import database)

Boat_ecological.sensitivity.INDICATORS <- read.csv("data/CSV_ecological_boat/Boat_ecological.sensitivity.INDICATORS.csv", sep = ";" )

##2. use functions to normalize:
##a) Normalization positive

sensitivity<- Boat_ecological.sensitivity.INDICATORS %>% 
  select(fishing.guild, Q, ABUND, HARV, EXPLOT)%>% 
  distinct%>%
  mutate (QN=normalize_positive(Q),
          ABUNDN=normalize_positive(ABUND),
          HARVN=normalize_positive(HARV),
          EXPLOTN=normalize_positive(EXPLOT))

sensitivity.N<- sensitivity [, c(1, 6, 7, 8, 9)]

eco.sensitivity <- sensitivity.N [, c(2:5)]
eco.sensitivity.cor <- cor(eco.sensitivity, use = "pairwise.complete.obs")
p2 <- corrplot(eco.sensitivity.cor, order ="AOE")

#C. ############RECOVERY POTENTIAL
##1. read cvs indicators (import database)

Boat_ecological.recoverypot.INDICATORS <- read.csv("data/CSV_ecological_boat/Boat_ecological.recoverypot.INDICATORS.csv", sep = ";" )

##2. use functions to normalize:
##a) Normalization positive

recovery.pot<- Boat_ecological.recoverypot.INDICATORS %>% 
  select(fishing.guild, bank.length, bank.area)%>% 
  distinct%>%
  mutate (bank.lengthN=normalize_positive(bank.length),
          bank.areaN=normalize_positive(bank.area))
        
recovery.potN<- recovery.pot [, c(1, 4, 5)]

eco.recoverypot <- recovery.potN [, c(2:3)]
eco.recoverypot.cor <- cor(eco.recoverypot, use = "pairwise.complete.obs")
p3 <- corrplot(eco.recoverypot.cor, order ="AOE")

##########MATRIX DE CORRELACIONES#############
# READ DE DATA (si queremos analizar los datos de manera conjunta)
#corr.matrix<- merge(exposure.N, sensitivity.N)
#corr.matrix2<- merge(corr.matrix, recovery.potN)
#cor.eco_indicators.matrix <- (corr.matrix2 [ ,2:10])
#ecological_correlation <- cor(cor.eco_indicators.matrix, use="pairwise.complete.obs")
#p4 <- corrplot(ecological_correlation, order ="AOE")


#2. ######################SOCIOECONOMIC##########
##1. read cvs indicators (import database)
#A. SENSITIVITY

Boat_socioeco.sensitivity <- read.csv("Data/CSV_socio.eco_boat/Boat_socioeco.sensitivity.csv", sep = ";" )

##2. use functions to normalize:
##a) Normalization positive
sensitivity.SE<- Boat_socioeco.sensitivity %>% 
  select(fishing.guild, NFISHERS, FDAYS, BENEFIT, CATCH.V, KG.SOLD, DAYS.SOLD, POUCH, ISO, UNEMP)%>% 
  distinct%>%
  mutate (NFISHERSN=normalize_positive(NFISHERS),
          FDAYSN=normalize_positive(FDAYS),
          BENEFITN=normalize_positive(BENEFIT),
          CATCH.VN=normalize_positive(CATCH.V),
          KG.SOLDN=normalize_positive(KG.SOLD),
          DAYS.SOLDN=normalize_positive(DAYS.SOLD),
          POUCHN=normalize_positive(POUCH),
          ISON=normalize_positive(ISO),
          UNEMPN=normalize_positive(UNEMP))

sensitivity.SE.N<- sensitivity.SE [, c(1, 11:19)]

socioeco.sensitivity <- sensitivity.SE.N [, c(2:10)]
socioeco.sensitivity.cor <- cor(socioeco.sensitivity, use = "pairwise.complete.obs")
p5 <- corrplot(socioeco.sensitivity.cor, order ="AOE")

#B. ADAPTIVE CAPACITY
##1. read cvs indicators (import database)

Boat.socioeco.adaptcap <- read.csv("Data/CSV_socio.eco_boat/Boat.socioeco.adaptcap.csv", sep = ";" )

##2. use functions to normalize:
##a) Normalization positive
adapt.cap<- Boat.socioeco.adaptcap %>% 
  select(fishing.guild, CPI, GROSS.SALARY, POB.RISK, RESOURCE.DEP, INCOME.DEP, TOURIST, MARKET, ROTATION, CLOUSURE)%>% 
  distinct%>%
  mutate (CPIN=normalize_positive(CPI),
          GROSS.SALARYN=normalize_positive(GROSS.SALARY),
          POB.RISKN=normalize_positive(POB.RISK),
          RESOURCE.DEPN= (RESOURCE.DEP),
          INCOME.DEPN= (INCOME.DEP),
          TOURISTN=normalize_positive(TOURIST),
          MARKETN=normalize_positive(MARKET),
          ROTATION.N=normalize_positive(ROTATION),
          CLOUSURE.N=normalize_positive(CLOUSURE))

adapt.cap.N<- adapt.cap [, c(1,  11:19)]

socioeco.adaptcap <- adapt.cap.N [, c(2:10)]
socioeco.adaptcap.cor <- cor(socioeco.adaptcap, use = "pairwise.complete.obs")
p6 <- corrplot(socioeco.adaptcap.cor, order ="AOE")

##########MATRIX DE CORRELACIONES#############
# READ DE DATA (en caso de querer analizar los indicadores conjuntamente)
#SE.corr.matrix<- merge(sensitivity.SE.N, adapt.cap.N)

####FACTORS_ECOLOGICAL#####       a partir de aquí no lo he revisado
#a. ecological exposure
CLIME= exposure.N$TempN-exposure.N$PPN-exposure.N$IRN
EXPOSURE=CLIME

#b. ecological sensitivity
Quality_change= sensitivity.N$QN
Quality_change

Quantity_change= sensitivity.N$AbundanceN+sensitivity.N$HarvN+sensitivity.N$ExplotN
Quantity_change

SENSITIVITY= Quality_change+Quantity_change
SENSITIVITY

#c. ecological recovery potencial
Habitat.extend= bank.lengthN+bank.areaN
Habitat.extend

RECOVERY.POT=Habitat.extend

#Ecological vulnerability
ECOLOGICAL_VULNERABILITY= EXPOSURE+SENSITIVITY-RECOVERY.POTENCIAL


####FACTORS_SOCIOECONOMIC####
#a.socioeco_sensitivity
WORK.OPERATION=NFishersN+FdaysN
WORK.OPERATION

PROFIT= BenefitN+Catch.VN+Kg.soldN+Days.soldN
PROFIT

POUCH=PouchN
POUCH

EMPLOY= IsoN+UnempN
EMPLOY

SENSITIVITY.SE= WORK.OPERATION+PROFIT+EMPLOY+POUCH
SENSITIVITY.SE

#b. socio_eco adaptive capacity
ECONOMIC.STRENGTH= Gross.salaryN-CPIN #Revisar si es + o -
ECONOMIC.STRENGTH

DEPENDENCY=Pob.riskN+Resour.depN+MarketN
DEPENDENCY

MANGMT.STRATEGIES= RotationN+ClousureN

LIVELIHOOD.DIV=TourismN+Income.depN
LIVELIHOOD.DIV

ADAPTIVE.CAPACITY= ECONOMIC.STRENGTH + MANGMT.STRATEGIES+ LIVELIHOOD.DIV- DEPENDENCY
ADAPTIVE.CAPACITY

######Socio-ecological vulnerabiliy######
SOCIO_ECOLOGICAL.VULNERABILITY= ECOLOGICAL_VULNERABILITY+SENSITIVITY.SE-ADAPTIVE.CAPACITY