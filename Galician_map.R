#Packages#
####Nota: Error: "grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y polygon edge not found" se soluciona corriendo otra vez la libreria devtool.
install.packages("devtools")
library(devtools)
install_github("tidyverse/ggplot2") 
install.packages("tidyverse")
library(tidyverse)
install.packages("sf")
library(sf)
install.packages("ggplot2")
library(ggplot2)

Galicia_area <- sf::st_read("MAPAS/Concellos/Concellos_IGN.dbf", quiet = TRUE)
class(Galicia_area)


Galicia_area %>% 
  ggplot() +
  theme_bw() +
  geom_sf(aes(fill = factor(Concello))) +
  scale_colour_brewer() +
  theme(legend.position = "none") +
  labs(title = "Galician map",
       subtitle = "Used for...")

####Socio_ecological Vulnerability by boat#####
Boat_socioecological_vunerability <- read.csv("Boat_Socioecological_vulnerabilitymapa.csv", sep = ";", encoding="UTF-8")
Boat_socioecological_vunerability

Encoding(Boat_socioecological_vunerability$concello) <- "UTF-8"
Encoding(Boat_socioecological_vunerability$concello) <- "UTF-8"

enc2utf8(Boat_socioecological_vunerability$Concello)

as.vector(Boat_socioecological_vunerability$Concello, mode="any")


boat <- read.csv("Boat_Socioecological_vulnerabilitymapa.csv", header = TRUE, sep = ",", dec = ".",
                         filled =TRUE, comment.char = "", strip.white = TRUE,
stringsAsFactors = TRUE, encoding="UTF-8")
############

#########

joined <- merge(Galicia_area, Boat_socioecological_vunerability , by="Concello", all.x=TRUE)

joined %>% 
  ggplot() +
  theme_bw() +
  geom_sf(aes(fill = SOCIOECOLOGICAL_VUL)) +
  scale_colour_brewer() +
  labs(title = "Socio-ecological Vulnerability Map",
       subtitle = "Concellos",
       fill = "Vulnerability") 

joined2 %>% 
  ggplot() +
  theme_bw() +
  geom_sf(aes(fill = SOCIOECOLOGICAL_VUL)) +
  scale_colour_gradient(low = "#132B43", high = "#56B1F7", space = "Lab", na.value = "grey50", guide = "colourbar") +
  labs(title = "Socio-ecological Vulnerability Map",
       subtitle = "Concellos",
       fill = "Vulnerability") 

####Socio_ecological Vulnerability by foot#####

######
if(!require(broom)){
  install.packages("broom",dependencies = TRUE,repos='http://cran.us.r-project.org')
}
require(broom)
packageVersion("broom")
# [1] ‘0.4.2’

if(!require(ggmap)){
  install.packages("ggmap",dependencies = TRUE,repos='http://cran.us.r-project.org')
}
require(ggmap)
packageVersion("ggmap")
# [1] ‘2.6.1’

if(!require(sp)){
  install.packages("sp",dependencies = TRUE,repos='http://cran.us.r-project.org')
}
require(sp)
packageVersion("sp")
# [1] ‘1.2.7’


if(!require(rgdal)){
  install.packages("rgdal",dependencies = TRUE,repos='http://cran.us.r-project.org')
}
require(rgdal)
packageVersion("rgdal")
# [1] ‘1.2.20’


if(!require(rnaturalearthdata)){
  install.packages("rnaturalearthdata",dependencies = TRUE,repos='http://cran.us.r-project.org')
}
require(rnaturalearthdata)
packageVersion("rnaturalearthdata")
# [1] ‘0.1.0’

if(!require(tidyverse)){
  install.packages("tidyverse",dependencies = TRUE,repos='http://cran.us.r-project.org')
}
require(tidyverse)
packageVersion("tidyverse")
# [1] ‘1.2.1’

#
