#Plot Factor contribution by dimension
#Create manually a colum called dimension.
Boat_exposurse.eco_factors <- read.csv("Boat_ecological_factors.matrix.csv", sep = ";" )
Boat_socioeco.sen_factors <- read.csv("Boat_socioeco_Sensitivity.csv", sep = ";" )
Boat_socioeco.adapt_factors <- read.csv("Boat_socioeco_adapt.csv", sep = ";" )

Boat_exp_factors <- Boat_exposurse.eco_factors %>% gather(FACTOR, value, -fishing.guild, -DIMENSION, factor_key=TRUE)  %>% mutate(FACTOR=gsub("\\."," ",as.character(FACTOR)))  %>% mutate(FACTOR=factor(FACTOR,levels = c("CLIME","QUANTITY_CHANGE","HABITAT")))

Boat_sen_factors <- Boat_socioeco.sen_factors  %>% gather(FACTOR, value, -fishing.guild, -DIMENSION, factor_key=TRUE)  %>% mutate(FACTOR=gsub("\\."," ",as.character(FACTOR)))  %>% mutate(FACTOR=factor(FACTOR,levels = c("POUCHN","WORK_OPE","EMPLOY_DIF","PROFIT")))

Boat_adapt.cap_factors <- Boat_socioeco.adapt_factors %>% gather(FACTOR, value, -fishing.guild, -DIMENSION, factor_key=TRUE)  %>% mutate(FACTOR=gsub("\\."," ",as.character(FACTOR)))  %>% mutate(FACTOR=factor(FACTOR,levels = c("ECONOMIC_STRENGTH","DEPENDENCY","MANAGEMENT_STRATEGIES","LIVELIHOOD_DIV")))

b <- merge(Boat_exp_factors, Boat_sen_factors, by="fishing.guild", all.x=TRUE)
b1<- merge(b, Boat_adapt.cap_factors, by="fishing.guild", all.x=TRUE)

#CREATE THE DATABASE MANUALLY.

Eco_factors <- read.csv("Foot_ecological_factors.matrix.csv", sep = ";" )
socioeco.sen_factors <- read.csv("Foot_socioeco_Sensitivity.csv", sep = ";" )
socioeco.adapt_factors <- read.csv("Foot_socioeco_adapt.csv", sep = ";" )



dimension <- c("Boat_exp_factors","Boat_sen_factors","Boat_adapt.cap_factors")

dimension_colors <- list(exp_factors=c("seagreen3","seagreen4"),
                         sen_factors=c("yellow3","yellow4"),
                         reco_factors=c("cornsilk3","cornsilk4"))

graphs <- dimensions  %>% lapply(function(DIMENSION){
  # dimension <- "soc_factors" tengo que llamar una a una las bases de datos
  x<- get(dimension)
  
  s <- ggplot(data=na.omit(Boat_exp_factors), aes(x= fishing.guild , y=value, fill=FACTOR))+
    geom_bar(stat = "identity", position=position_dodge(width=0.4), width=0.3)+
    facet_grid(~FACTOR)+
    coord_flip()+
    theme_classic()+
    ylab("")+
    xlab("fishing.guild")+
    theme(axis.text.y = element_text(size=10, color="black"),
          axis.text.x = element_text(size=10,color="black",angle=50,hjust=1),
          legend.text = element_text(size=10,color = "black"),
          legend.title = element_text(size=10,color="black"),
          panel.spacing.x = unit(1,"lines"),
          strip.text = element_text(color="black",face="bold",size=11))
  s 
  
  
  if(dimension!="eco_factors"){
    
    g <- g + theme(axis.title.y = element_blank())
  }else{
    g <- g + theme(axis.title.y = element_text(size=26, color="black"))
    
  }
  g 
})

png("Figures/Fig 2 SI.png",width=25,height=12,units="in",res=300)

do.call(grid_arrange_shared_legend,c(graphs, list(nrow = 1, ncol = 3)))

dev.off()